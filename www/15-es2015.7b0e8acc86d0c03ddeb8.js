(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{uzno:function(e,t,i){"use strict";i.r(t),i.d(t,"SalePageModule",function(){return S});var o=i("ofXK"),s=i("3Pt+"),r=i("TEn/"),c=i("tyNb"),n=i("mrSG"),a=i("fXoL"),l=i("8z/i"),b=i("t5L3");let u=(()=>{class e{transform(e,t){if(""!==t)return t=t.toLowerCase(),e.filter(e=>e.barCode.includes(t))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=a.Kb({name:"productFilter",type:e,pure:!0}),e})();function d(e,t){if(1&e){const e=a.Pb();a.Ob(0,"ion-row"),a.Ob(1,"ion-col",4),a.Wb("click",function(){a.hc(e);const i=t.$implicit;return a.Yb().addToFilteredProduct(i)}),a.Ob(2,"ion-label"),a.mc(3),a.Nb(),a.Nb(),a.Ob(4,"ion-col",4),a.Wb("click",function(){a.hc(e);const i=t.$implicit;return a.Yb().addToFilteredProduct(i)}),a.Ob(5,"ion-label"),a.mc(6),a.Nb(),a.Nb(),a.Nb()}if(2&e){const e=t.$implicit;a.Bb(3),a.nc(e.name),a.Bb(3),a.nc(e.unitPrice)}}let h=(()=>{class e{constructor(e,t,i){this.productsService=e,this.saleService=t,this.modalCtrl=i,this.search="",this.allProducts=[],e.getAllProducts().subscribe(e=>{this.allProducts=e})}ngOnInit(){}onSearchProduct(e){this.search=e.detail.value}addToFilteredProduct(e){if(0===this.saleService.searchedProducts.length){this.saleService.searchedProducts.push(e);const t=e.id;this.saleService.tableSels[t]={productID:t,productName:e.name,unitPrice:e.unitPrice,quantity:1},console.log(this.saleService.tableSels);let i=0;this.saleService.searchedProducts.forEach(e=>{i+=this.saleService.tableSels[e.id].quantity*this.saleService.tableSels[e.id].unitPrice}),this.saleService.total=i}if(this.saleService.searchedProducts.includes(e))return void console.log(e);const t=e.id,i={productID:t,productName:e.name,unitPrice:e.unitPrice,quantity:1};console.log(e.name);let o=!1;if(this.saleService.searchedProducts.forEach(e=>{e.id===t&&(console.log(e.id,e.name,e.barCode,t),o=!0)}),console.log(o),o)return;this.saleService.searchedProducts.push(e),this.saleService.tableSels[t]=i,console.log(this.saleService.tableSels);let s=0;this.saleService.searchedProducts.forEach(e=>{s+=this.saleService.tableSels[e.id].quantity*this.saleService.tableSels[e.id].unitPrice}),this.saleService.total=s,console.log(this.saleService.total),o=!1}}return e.\u0275fac=function(t){return new(t||e)(a.Lb(l.a),a.Lb(b.a),a.Lb(r.E))},e.\u0275cmp=a.Fb({type:e,selectors:[["app-modal-find-product"]],decls:11,vars:4,consts:[["placeholder","buscar","animated","","debounce","500",3,"ionChange"],["fixed",""],["size","6"],[4,"ngFor","ngForOf"],["size","6",1,"pointer",3,"click"]],template:function(e,t){1&e&&(a.Ob(0,"div"),a.Ob(1,"ion-searchbar",0),a.Wb("ionChange",function(e){return t.onSearchProduct(e)}),a.Nb(),a.Ob(2,"ion-list"),a.Ob(3,"ion-grid",1),a.Ob(4,"ion-row"),a.Ob(5,"ion-col",2),a.mc(6,"Nombre"),a.Nb(),a.Ob(7,"ion-col",2),a.mc(8,"Precio"),a.Nb(),a.Nb(),a.kc(9,d,7,2,"ion-row",3),a.Zb(10,"productFilter"),a.Nb(),a.Nb(),a.Nb()),2&e&&(a.Bb(9),a.ec("ngForOf",a.bc(10,1,t.allProducts,t.search)))},directives:[r.u,r.I,r.p,r.i,r.t,r.f,o.i,r.o],pipes:[u],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),e})();var m=i("PZxA");function v(e,t){if(1&e){const e=a.Pb();a.Ob(0,"ion-row"),a.Ob(1,"ion-col",9),a.Ob(2,"p"),a.mc(3),a.Nb(),a.Nb(),a.Ob(4,"ion-col",9),a.Ob(5,"p"),a.mc(6),a.Nb(),a.Nb(),a.Ob(7,"ion-col",10),a.Ob(8,"p"),a.mc(9),a.Nb(),a.Nb(),a.Ob(10,"ion-col",10),a.Ob(11,"ion-input",18),a.Wb("ionChange",function(i){a.hc(e);const o=t.$implicit;return a.Yb().getProductValues(o,i)}),a.Nb(),a.Nb(),a.Ob(12,"ion-col",19),a.Ob(13,"ion-button",20),a.Wb("click",function(){a.hc(e);const i=t.$implicit,o=t.index;return a.Yb().deleteFromTable(i,o)}),a.Mb(14,"ion-icon",21),a.Nb(),a.Nb(),a.Nb()}if(2&e){const e=t.$implicit;a.Bb(3),a.nc(e.barCode),a.Bb(3),a.nc(e.name),a.Bb(3),a.nc(e.unitPrice),a.Bb(2),a.ec("max",e.stock)}}const f=[{path:"",component:(()=>{class e{constructor(e,t,i,o,r,c,n){this.formBuilder=e,this.router=t,this.menu=i,this.modalCtrl=o,this.saleService=r,this.validatorService=c,this.productsService=n,this.search="",this.allProducts=[],this.searchedProducts=[],this.payment=0,this.change=0,this.form=this.formBuilder.group({pagado:[0,[s.l.required,s.l.min(1)]],cambio:[0,[s.l.required,s.l.min(0)]],total:[this.saleService.total,[s.l.required,s.l.min(1)]]},{validators:[this.validatorService.precioIgualMayor("total","pagado")]}),this.productsService.getAllProducts().subscribe(e=>{this.allProducts=e.filter(e=>e.stock>0)})}ngOnInit(){let e,t="";document.addEventListener("keydown",i=>{if(e&&clearInterval(e),"Enter"===i.code)return t&&"/sale"===this.router.url&&this.getProductByBarCode(t),void(t="");"Shift"!==i.code&&(t+=i.key),e=setInterval(()=>t="",500)}),this.menu.swipeGesture(!1,"first")}onToggleMenu(){this.menu.enable(!0,"first"),this.menu.open("first")}cambio(){this.payment=this.form.get("pagado").value,this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}onAddSale(){this.form.invalid?this.form.markAllAsTouched():(this.saleService.addSale(this.saleService.tableSels,this.searchedProducts,this.form.value),this.form.reset(),this.saleService.tableSels=[],this.saleService.searchedProducts=[],this.saleService.total=0,this.searchedProducts=this.saleService.searchedProducts,this.form.get("cambio").setValue(0))}getProductValues(e,t){var i;const o=e.id,s=(null===(i=t.detail)||void 0===i?void 0:i.value)?t.detail.value:1;this.saleService.tableSels[o]={productID:o,unitPrice:e.unitPrice,quantity:s};let r=0;this.saleService.searchedProducts.forEach(e=>{r+=this.saleService.tableSels[e.id].quantity*this.saleService.tableSels[e.id].unitPrice}),console.log(r),this.saleService.total=r,this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}getProductByBarCode(e){return Object(n.b)(this,void 0,void 0,function*(){let t=!1;if(!e)return;if(this.allProducts.find(i=>{i.barCode===e&&(t=!0)}),!t)return;const i=this.allProducts.find(t=>t.barCode===e);this.searchedProducts=this.saleService.searchedProducts;let o=!1;if(this.saleService.searchedProducts.forEach(e=>{e.barCode===i.barCode&&(o=!0)}),o)return;const s=i.id;this.saleService.tableSels[s]={productID:s,productName:i.name,unitPrice:i.unitPrice,quantity:1},this.saleService.searchedProducts.push(i),this.searchedProducts=this.saleService.searchedProducts,this.saleService.searchedProducts.forEach(e=>{this.saleService.total+=1*e.unitPrice}),this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change),this.saleService.total=0})}presentModal(){return Object(n.b)(this,void 0,void 0,function*(){const e=yield this.modalCtrl.create({component:h,cssClass:"my-custom-class"});yield e.present();const{data:t}=yield e.onWillDismiss();void 0===t&&this.form.get("total").setValue(this.saleService.total)})}deleteFromTable(e,t){this.saleService.searchedProducts.splice(t,1),delete this.saleService.tableSels[e.id];let i=0;this.searchedProducts.forEach(e=>{i+=this.saleService.tableSels[e.id].quantity*this.saleService.tableSels[e.id].unitPrice}),this.saleService.total=i,this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}}return e.\u0275fac=function(t){return new(t||e)(a.Lb(s.a),a.Lb(c.g),a.Lb(r.D),a.Lb(r.E),a.Lb(b.a),a.Lb(m.a),a.Lb(l.a))},e.\u0275cmp=a.Fb({type:e,selectors:[["app-sale"]],decls:45,vars:3,consts:[[1,"ion-no-border"],["slot","start"],[3,"click"],["slot","icon-only","name","menu-outline"],[1,"ion-text-center"],["slot","end"],["slot","icon-only","name","search"],["id","content",3,"fullscreen"],["size","9"],["size","3",1,"ion-text-center"],["size","2",1,"ion-text-center"],[4,"ngFor","ngForOf"],["size","3"],[3,"formGroup","ngSubmit"],["type","number","formControlName","total","readonly",""],["type","number","formControlName","pagado",3,"ionChange"],["type","number","readonly","","formControlName","cambio"],["expand","block","type","submit"],["type","number","value","1","min","1",3,"max","ionChange"],["size","2"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(e,t){1&e&&(a.Ob(0,"ion-header",0),a.Ob(1,"ion-toolbar"),a.Ob(2,"ion-buttons",1),a.Ob(3,"ion-button",2),a.Wb("click",function(){return t.onToggleMenu()}),a.Mb(4,"ion-icon",3),a.Nb(),a.Nb(),a.Ob(5,"ion-title",4),a.mc(6,"Ventas"),a.Nb(),a.Ob(7,"ion-buttons",5),a.Ob(8,"ion-button",2),a.Wb("click",function(){return t.presentModal()}),a.Mb(9,"ion-icon",6),a.Nb(),a.Nb(),a.Nb(),a.Nb(),a.Ob(10,"ion-content",7),a.Ob(11,"ion-grid"),a.Ob(12,"ion-row"),a.Ob(13,"ion-col",8),a.Ob(14,"ion-grid"),a.Ob(15,"ion-row"),a.Ob(16,"ion-col",9),a.Ob(17,"h6"),a.mc(18," C\xf3digo "),a.Nb(),a.Nb(),a.Ob(19,"ion-col",9),a.Ob(20,"h6"),a.mc(21," Nombre "),a.Nb(),a.Nb(),a.Ob(22,"ion-col",10),a.Ob(23,"h6"),a.mc(24," Precio "),a.Nb(),a.Nb(),a.Ob(25,"ion-col",10),a.Ob(26,"h6"),a.mc(27," Cantidad "),a.Nb(),a.Nb(),a.Nb(),a.kc(28,v,15,4,"ion-row",11),a.Nb(),a.Nb(),a.Ob(29,"ion-col",12),a.Ob(30,"form",13),a.Wb("ngSubmit",function(){return t.onAddSale()}),a.Ob(31,"ion-item"),a.Ob(32,"ion-label"),a.mc(33,"Total:"),a.Nb(),a.Mb(34,"ion-input",14),a.Nb(),a.Ob(35,"ion-item"),a.Ob(36,"ion-label"),a.mc(37,"Pagado:"),a.Nb(),a.Ob(38,"ion-input",15),a.Wb("ionChange",function(){return t.cambio()}),a.Nb(),a.Nb(),a.Ob(39,"ion-item"),a.Ob(40,"ion-label"),a.mc(41,"Cambio:"),a.Nb(),a.Mb(42,"ion-input",16),a.Nb(),a.Ob(43,"ion-button",17),a.mc(44," Pagar "),a.Nb(),a.Nb(),a.Nb(),a.Nb(),a.Nb(),a.Nb()),2&e&&(a.Bb(10),a.ec("fullscreen",!0),a.Bb(18),a.ec("ngForOf",t.saleService.searchedProducts),a.Bb(2),a.ec("formGroup",t.form))},directives:[r.j,r.A,r.e,r.d,r.k,r.y,r.g,r.i,r.t,r.f,o.i,s.m,s.h,s.c,r.m,r.o,r.l,r.F,s.g,s.b],styles:[""]}),e})()}];let p=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.Jb({type:e}),e.\u0275inj=a.Ib({imports:[[c.j.forChild(f)],c.j]}),e})(),S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.Jb({type:e}),e.\u0275inj=a.Ib({imports:[[o.c,s.k,r.B,p]]}),e})()}}]);