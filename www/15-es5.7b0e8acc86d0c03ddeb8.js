!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{uzno:function(t,r,n){"use strict";n.r(r),n.d(r,"SalePageModule",function(){return C});var o,a=n("ofXK"),c=n("3Pt+"),s=n("TEn/"),l=n("tyNb"),u=n("mrSG"),b=n("fXoL"),h=n("8z/i"),d=n("t5L3"),f=((o=function(){function t(){e(this,t)}return i(t,[{key:"transform",value:function(e,t){if(""!==t)return t=t.toLowerCase(),e.filter(function(e){return e.barCode.includes(t)})}}]),t}()).\u0275fac=function(e){return new(e||o)},o.\u0275pipe=b.Kb({name:"productFilter",type:o,pure:!0}),o);function m(e,t){if(1&e){var i=b.Pb();b.Ob(0,"ion-row"),b.Ob(1,"ion-col",4),b.Wb("click",function(){b.hc(i);var e=t.$implicit;return b.Yb().addToFilteredProduct(e)}),b.Ob(2,"ion-label"),b.mc(3),b.Nb(),b.Nb(),b.Ob(4,"ion-col",4),b.Wb("click",function(){b.hc(i);var e=t.$implicit;return b.Yb().addToFilteredProduct(e)}),b.Ob(5,"ion-label"),b.mc(6),b.Nb(),b.Nb(),b.Nb()}if(2&e){var r=t.$implicit;b.Bb(3),b.nc(r.name),b.Bb(3),b.nc(r.unitPrice)}}var v,p=((v=function(){function t(i,r,n){var o=this;e(this,t),this.productsService=i,this.saleService=r,this.modalCtrl=n,this.search="",this.allProducts=[],i.getAllProducts().subscribe(function(e){o.allProducts=e})}return i(t,[{key:"ngOnInit",value:function(){}},{key:"onSearchProduct",value:function(e){this.search=e.detail.value}},{key:"addToFilteredProduct",value:function(e){var t=this;if(0===this.saleService.searchedProducts.length){this.saleService.searchedProducts.push(e);var i=e.id;this.saleService.tableSels[i]={productID:i,productName:e.name,unitPrice:e.unitPrice,quantity:1},console.log(this.saleService.tableSels);var r=0;this.saleService.searchedProducts.forEach(function(e){r+=t.saleService.tableSels[e.id].quantity*t.saleService.tableSels[e.id].unitPrice}),this.saleService.total=r}if(this.saleService.searchedProducts.includes(e))console.log(e);else{var n=e.id,o={productID:n,productName:e.name,unitPrice:e.unitPrice,quantity:1};console.log(e.name);var a=!1;if(this.saleService.searchedProducts.forEach(function(e){e.id===n&&(console.log(e.id,e.name,e.barCode,n),a=!0)}),console.log(a),!a){this.saleService.searchedProducts.push(e),this.saleService.tableSels[n]=o,console.log(this.saleService.tableSels);var c=0;this.saleService.searchedProducts.forEach(function(e){c+=t.saleService.tableSels[e.id].quantity*t.saleService.tableSels[e.id].unitPrice}),this.saleService.total=c,console.log(this.saleService.total),a=!1}}}}]),t}()).\u0275fac=function(e){return new(e||v)(b.Lb(h.a),b.Lb(d.a),b.Lb(s.E))},v.\u0275cmp=b.Fb({type:v,selectors:[["app-modal-find-product"]],decls:11,vars:4,consts:[["placeholder","buscar","animated","","debounce","500",3,"ionChange"],["fixed",""],["size","6"],[4,"ngFor","ngForOf"],["size","6",1,"pointer",3,"click"]],template:function(e,t){1&e&&(b.Ob(0,"div"),b.Ob(1,"ion-searchbar",0),b.Wb("ionChange",function(e){return t.onSearchProduct(e)}),b.Nb(),b.Ob(2,"ion-list"),b.Ob(3,"ion-grid",1),b.Ob(4,"ion-row"),b.Ob(5,"ion-col",2),b.mc(6,"Nombre"),b.Nb(),b.Ob(7,"ion-col",2),b.mc(8,"Precio"),b.Nb(),b.Nb(),b.kc(9,m,7,2,"ion-row",3),b.Zb(10,"productFilter"),b.Nb(),b.Nb(),b.Nb()),2&e&&(b.Bb(9),b.ec("ngForOf",b.bc(10,1,t.allProducts,t.search)))},directives:[s.u,s.I,s.p,s.i,s.t,s.f,a.i,s.o],pipes:[f],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),v),S=n("PZxA");function g(e,t){if(1&e){var i=b.Pb();b.Ob(0,"ion-row"),b.Ob(1,"ion-col",9),b.Ob(2,"p"),b.mc(3),b.Nb(),b.Nb(),b.Ob(4,"ion-col",9),b.Ob(5,"p"),b.mc(6),b.Nb(),b.Nb(),b.Ob(7,"ion-col",10),b.Ob(8,"p"),b.mc(9),b.Nb(),b.Nb(),b.Ob(10,"ion-col",10),b.Ob(11,"ion-input",18),b.Wb("ionChange",function(e){b.hc(i);var r=t.$implicit;return b.Yb().getProductValues(r,e)}),b.Nb(),b.Nb(),b.Ob(12,"ion-col",19),b.Ob(13,"ion-button",20),b.Wb("click",function(){b.hc(i);var e=t.$implicit,r=t.index;return b.Yb().deleteFromTable(e,r)}),b.Mb(14,"ion-icon",21),b.Nb(),b.Nb(),b.Nb()}if(2&e){var r=t.$implicit;b.Bb(3),b.nc(r.barCode),b.Bb(3),b.nc(r.name),b.Bb(3),b.nc(r.unitPrice),b.Bb(2),b.ec("max",r.stock)}}var P,O,N,y=[{path:"",component:(P=function(){function t(i,r,n,o,a,s,l){var u=this;e(this,t),this.formBuilder=i,this.router=r,this.menu=n,this.modalCtrl=o,this.saleService=a,this.validatorService=s,this.productsService=l,this.search="",this.allProducts=[],this.searchedProducts=[],this.payment=0,this.change=0,this.form=this.formBuilder.group({pagado:[0,[c.l.required,c.l.min(1)]],cambio:[0,[c.l.required,c.l.min(0)]],total:[this.saleService.total,[c.l.required,c.l.min(1)]]},{validators:[this.validatorService.precioIgualMayor("total","pagado")]}),this.productsService.getAllProducts().subscribe(function(e){u.allProducts=e.filter(function(e){return e.stock>0})})}return i(t,[{key:"ngOnInit",value:function(){var e,t=this,i="";document.addEventListener("keydown",function(r){if(e&&clearInterval(e),"Enter"===r.code)return i&&"/sale"===t.router.url&&t.getProductByBarCode(i),void(i="");"Shift"!==r.code&&(i+=r.key),e=setInterval(function(){return i=""},500)}),this.menu.swipeGesture(!1,"first")}},{key:"onToggleMenu",value:function(){this.menu.enable(!0,"first"),this.menu.open("first")}},{key:"cambio",value:function(){this.payment=this.form.get("pagado").value,this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}},{key:"onAddSale",value:function(){this.form.invalid?this.form.markAllAsTouched():(this.saleService.addSale(this.saleService.tableSels,this.searchedProducts,this.form.value),this.form.reset(),this.saleService.tableSels=[],this.saleService.searchedProducts=[],this.saleService.total=0,this.searchedProducts=this.saleService.searchedProducts,this.form.get("cambio").setValue(0))}},{key:"getProductValues",value:function(e,t){var i,r=this,n=e.id,o=(null===(i=t.detail)||void 0===i?void 0:i.value)?t.detail.value:1;this.saleService.tableSels[n]={productID:n,unitPrice:e.unitPrice,quantity:o};var a=0;this.saleService.searchedProducts.forEach(function(e){a+=r.saleService.tableSels[e.id].quantity*r.saleService.tableSels[e.id].unitPrice}),console.log(a),this.saleService.total=a,this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}},{key:"getProductByBarCode",value:function(e){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,r,n,o,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!1,e){t.next=3;break}return t.abrupt("return");case 3:if(this.allProducts.find(function(t){t.barCode===e&&(i=!0)}),i){t.next=5;break}return t.abrupt("return");case 5:if(r=this.allProducts.find(function(t){return t.barCode===e}),this.searchedProducts=this.saleService.searchedProducts,n=!1,this.saleService.searchedProducts.forEach(function(e){e.barCode===r.barCode&&(n=!0)}),!n){t.next=10;break}return t.abrupt("return");case 10:o=r.id,this.saleService.tableSels[o]={productID:o,productName:r.name,unitPrice:r.unitPrice,quantity:1},this.saleService.searchedProducts.push(r),this.searchedProducts=this.saleService.searchedProducts,this.saleService.searchedProducts.forEach(function(e){a.saleService.total+=1*e.unitPrice}),this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change),this.saleService.total=0;case 12:case"end":return t.stop()}},t,this)}))}},{key:"presentModal",value:function(){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:p,cssClass:"my-custom-class"});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:void 0===e.sent.data&&this.form.get("total").setValue(this.saleService.total);case 10:case"end":return e.stop()}},e,this)}))}},{key:"deleteFromTable",value:function(e,t){var i=this;this.saleService.searchedProducts.splice(t,1),delete this.saleService.tableSels[e.id];var r=0;this.searchedProducts.forEach(function(e){r+=i.saleService.tableSels[e.id].quantity*i.saleService.tableSels[e.id].unitPrice}),this.saleService.total=r,this.form.get("total").setValue(this.saleService.total),this.change=this.payment-this.saleService.total>0?this.payment-this.saleService.total:0,this.form.get("cambio").setValue(this.change)}}]),t}(),P.\u0275fac=function(e){return new(e||P)(b.Lb(c.a),b.Lb(l.g),b.Lb(s.D),b.Lb(s.E),b.Lb(d.a),b.Lb(S.a),b.Lb(h.a))},P.\u0275cmp=b.Fb({type:P,selectors:[["app-sale"]],decls:45,vars:3,consts:[[1,"ion-no-border"],["slot","start"],[3,"click"],["slot","icon-only","name","menu-outline"],[1,"ion-text-center"],["slot","end"],["slot","icon-only","name","search"],["id","content",3,"fullscreen"],["size","9"],["size","3",1,"ion-text-center"],["size","2",1,"ion-text-center"],[4,"ngFor","ngForOf"],["size","3"],[3,"formGroup","ngSubmit"],["type","number","formControlName","total","readonly",""],["type","number","formControlName","pagado",3,"ionChange"],["type","number","readonly","","formControlName","cambio"],["expand","block","type","submit"],["type","number","value","1","min","1",3,"max","ionChange"],["size","2"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(e,t){1&e&&(b.Ob(0,"ion-header",0),b.Ob(1,"ion-toolbar"),b.Ob(2,"ion-buttons",1),b.Ob(3,"ion-button",2),b.Wb("click",function(){return t.onToggleMenu()}),b.Mb(4,"ion-icon",3),b.Nb(),b.Nb(),b.Ob(5,"ion-title",4),b.mc(6,"Ventas"),b.Nb(),b.Ob(7,"ion-buttons",5),b.Ob(8,"ion-button",2),b.Wb("click",function(){return t.presentModal()}),b.Mb(9,"ion-icon",6),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Ob(10,"ion-content",7),b.Ob(11,"ion-grid"),b.Ob(12,"ion-row"),b.Ob(13,"ion-col",8),b.Ob(14,"ion-grid"),b.Ob(15,"ion-row"),b.Ob(16,"ion-col",9),b.Ob(17,"h6"),b.mc(18," C\xf3digo "),b.Nb(),b.Nb(),b.Ob(19,"ion-col",9),b.Ob(20,"h6"),b.mc(21," Nombre "),b.Nb(),b.Nb(),b.Ob(22,"ion-col",10),b.Ob(23,"h6"),b.mc(24," Precio "),b.Nb(),b.Nb(),b.Ob(25,"ion-col",10),b.Ob(26,"h6"),b.mc(27," Cantidad "),b.Nb(),b.Nb(),b.Nb(),b.kc(28,g,15,4,"ion-row",11),b.Nb(),b.Nb(),b.Ob(29,"ion-col",12),b.Ob(30,"form",13),b.Wb("ngSubmit",function(){return t.onAddSale()}),b.Ob(31,"ion-item"),b.Ob(32,"ion-label"),b.mc(33,"Total:"),b.Nb(),b.Mb(34,"ion-input",14),b.Nb(),b.Ob(35,"ion-item"),b.Ob(36,"ion-label"),b.mc(37,"Pagado:"),b.Nb(),b.Ob(38,"ion-input",15),b.Wb("ionChange",function(){return t.cambio()}),b.Nb(),b.Nb(),b.Ob(39,"ion-item"),b.Ob(40,"ion-label"),b.mc(41,"Cambio:"),b.Nb(),b.Mb(42,"ion-input",16),b.Nb(),b.Ob(43,"ion-button",17),b.mc(44," Pagar "),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb()),2&e&&(b.Bb(10),b.ec("fullscreen",!0),b.Bb(18),b.ec("ngForOf",t.saleService.searchedProducts),b.Bb(2),b.ec("formGroup",t.form))},directives:[s.j,s.A,s.e,s.d,s.k,s.y,s.g,s.i,s.t,s.f,a.i,c.m,c.h,c.c,s.m,s.o,s.l,s.F,c.g,c.b],styles:[""]}),P)}],k=((N=function t(){e(this,t)}).\u0275fac=function(e){return new(e||N)},N.\u0275mod=b.Jb({type:N}),N.\u0275inj=b.Ib({imports:[[l.j.forChild(y)],l.j]}),N),C=((O=function t(){e(this,t)}).\u0275fac=function(e){return new(e||O)},O.\u0275mod=b.Jb({type:O}),O.\u0275inj=b.Ib({imports:[[a.c,c.k,s.B,k]]}),O)}}])}();